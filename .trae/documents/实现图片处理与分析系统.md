# 实现图片处理与分析系统

## 1. 后端实现计划

### 1.1 图片处理服务扩展
- **创建图片特征提取服务** (`app/services/image_features.py`)
  - 集成CLIP模型进行视觉和语义特征提取
  - 集成AESNet进行美学评分
  - 集成OpenCV进行信息量评分
  - 实现图片聚类算法

- **扩展照片过滤服务** (`app/services/photo_filter.py`)
  - 增强截图检测能力
  - 添加网络下载图片检测
  - 集成特征提取进行更准确的重复检测
  - 适配Gemini支持的图片类型

- **创建图片压缩服务** (`app/services/image_compressor.py`)
  - 实现自动裁剪无意义的黑边/白边
  - 实现智能缩放功能
  - 实现格式转换（HEIC/PNG/BMP → WEBP/JPG）
  - 处理透明通道和色深

- **扩展内存分析器** (`app/services/memory_analyzer.py`)
  - 集成新的图片处理流程
  - 添加图片MD5唯一标识生成
  - 实现图片存储逻辑
  - 优化图片处理性能

### 1.2 数据库模型扩展
- **扩展照片模型** (`app/models/photo.py`)
  - 添加特征向量存储
  - 添加美学评分字段
  - 添加信息量评分字段
  - 添加压缩后图片信息

- **扩展记忆记录模型** (`app/models/memory.py`)
  - 添加图片关联字段
  - 存储使用的图片列表

### 1.3 API扩展
- **添加图片相关API** (`app/api/image.py`)
  - 图片列表获取
  - 图片详情获取
  - 图片特征分析

- **扩展记忆分析API** (`app/api/memory.py`)
  - 添加图片关联信息返回
  - 支持图片过滤参数

### 1.4 部署适配
- **更新依赖** (`backend/requirements.txt`)
  - 添加CLIP、AESNet、OpenCV等依赖

- **更新Railway配置** (`backend/railway.json`)
  - 配置环境变量
  - 优化部署设置

## 2. 前端实现计划

### 2.1 页面扩展
- **修改记忆记录页面** (`src/pages/MemoryRecordsPage.jsx`)
  - 添加查看使用图片按钮
  - 实现图片列表展示
  - 适配新的API响应格式

- **创建图片查看页面** (`src/pages/ImageViewPage.jsx`)
  - 展示图片详情
  - 展示图片分析结果
  - 支持图片预览

### 2.2 API调用扩展
- **更新API服务** (`src/api/api.js`)
  - 添加图片相关API调用
  - 扩展记忆记录API调用

## 3. 实现步骤

1. **环境准备**
   - 安装必要的依赖包
   - 配置模型文件路径

2. **核心服务实现**
   - 实现图片特征提取服务
   - 实现图片压缩服务
   - 扩展照片过滤服务

3. **数据库模型更新**
   - 更新照片模型
   - 更新记忆记录模型

4. **API实现**
   - 实现图片相关API
   - 扩展记忆分析API

5. **前端实现**
   - 修改记忆记录页面
   - 创建图片查看页面
   - 更新API调用

6. **测试与优化**
   - 测试图片处理流程
   - 优化性能和稳定性
   - 适配Railway部署

7. **部署与验证**
   - 部署到Railway
   - 验证完整流程

## 4. 技术要点

- **图片处理性能优化**：使用异步处理和批处理减少处理时间
- **模型集成**：确保CLIP、AESNet等模型正确集成
- **存储优化**：实现高效的图片存储和检索
- **前端用户体验**：确保图片展示流畅，响应迅速
- **部署适配**：确保系统在Railway环境中稳定运行

## 5. 预期成果

- 完整的图片处理与分析系统
- 支持从iCloud获取并处理图片
- 智能过滤和压缩图片
- 前端支持查看使用的图片
- 适配Railway部署环境